<!DOCTYPE html>
<html>
  <head>
    <title>Spotify Web App</title>
  </head>
  <body>
    <button id="loginBtn" onclick="authorizeSpotify()">Log in with Spotify</button>
    <br /><br />
    <button id="playBtn" onclick="playSong()">Play Song</button>
    <button id="pauseBtn" onclick="pauseSong()">Pause Song</button>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <script>
      let accessToken;
      let deviceId;

      window.onSpotifyWebPlaybackSDKReady = () => {
        // Initialize the Spotify Web Playback SDK
        const player = new Spotify.Player({
          name: 'Web Playback SDK',
          getOAuthToken: (cb) => {
            cb(accessToken);
          },
        });

        // Connect to the player
        player.connect();

        // Playback event listeners
        player.addListener('ready', ({ device_id }) => {
          console.log('Ready with Device ID', device_id);
          deviceId = device_id; // Store the device ID
        });

        player.addListener('player_state_changed', (state) => {
          console.log('Player State Changed', state);
        });
      };

      function authorizeSpotify() {
        const clientId = 'fd6e3871692a443aad1e62f79254f5d1';
        const clientSecret = '0c29a0fd03264b4ea1eec051776e49da';
        const redirectUri = 'http://localhost:3000';
        const scope = 'user-read-private user-read-email streaming';

        // Request access token using client credentials flow
        fetch('https://accounts.spotify.com/api/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            Authorization: `Basic ${btoa(`${clientId}:${clientSecret}`)}`,
          },
          body: `grant_type=client_credentials`,
        })
          .then((response) => response.json())
          .then((data) => {
            accessToken = data.access_token;
            console.log('Access Token:', accessToken);
          })
          .catch((error) => {
            console.error('Error retrieving access token:', error);
          });
      }

      function playSong() {
        if (!deviceId) {
          console.error('No device ID available');
          return;
        }

        // Play a Spotify song
        const trackUri = 'spotify:track:3I7krC8kr0gFR7P6vInR1I';

        fetch(`https://api.spotify.com/v1/me/player/play?device_id=${deviceId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${accessToken}`,
          },
          body: JSON.stringify({ uris: [trackUri] }),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log('Song played:', data);
          })
          .catch((error) => {
            console.error('Error playing song:', error);
          });
      }

      function pauseSong() {
        if (!deviceId) {
          console.error('No device ID available');
          return;
        }

        // Pause the currently playing song
        fetch(`https://api.spotify.com/v1/me/player/pause?device_id=${deviceId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${accessToken}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log('Song paused:', data);
          })
          .catch((error) => {
            console.error('Error pausing song:', error);
          });
      }
    </script>
  </body>
</html>
